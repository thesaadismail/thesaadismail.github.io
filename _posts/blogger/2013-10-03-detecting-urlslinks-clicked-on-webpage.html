---
title: "Detecting URLs/Links Clicked on a Webpage"
layout: "post"
permalink: "/2013/10/detecting-urlslinks-clicked-on-webpage.html"
uuid: "8459733041091436202"
guid: "tag:blogger.com,1999:blog-4627720939429298175.post-8459733041091436202"
date: "2013-10-03 02:10:00"
updated: "2013-10-03 02:17:44"
description: 
blogger:
    siteid: "4627720939429298175"
    postid: "8459733041091436202"
    comments: "0"
categories: [development, windows-store-dev, webdev]
author: 
    name: "Gremsi"
    url: "http://www.blogger.com/profile/00614962079213173450?rel=author"
    image: "http://img2.blogblog.com/img/b16-rounded.gif"
---

<div class="css-full-post-content js-full-post-content">
<div dir="ltr" style="text-align: left;" trbidi="on"><div style="background-color: white;"><span style="background-color: transparent; font-family: Arial, Helvetica, sans-serif;">This has more to do with WebView in Windows Store APIs but it could apply to other situations since its just javascript. I wanted to find a way to detect what page the user navigates to, and unfortunately WebView does not have that functionality. So I had to resort to injecting javascript...</span></div><span style="font-family: Arial, Helvetica, sans-serif;"><br />Now I'm not a javascript expert, so if there are any better ways to do this please let me know :)</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br />Instead of changing each and every link and adding my own custom handlers, I decided to override the onclick event in the body. Whenever the user clicks anywhere on the page, my custom onclick handler will receive the event and handles it accordingly.&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br />It first checks to see if it is inside an &lt;a&gt; tag, if it is then we are pretty much done since we found the link. If it isnt, it continues to check the parent tag until it reaches the body. This handles cases where you have an &lt;img&gt; tag inside an &lt;a&gt; tag. So when the user clicks on the image, the onclick event will be received on the image and not the &lt;a&gt; tag. So we have to traverse upwards.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br />Here is the code:</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br />Link Detection Script</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><br /><div style="background-color: white;"><blockquote><span style="color: #666666; font-family: Arial, Helvetica, sans-serif;">&nbsp;document.body.onclick = function(e)<br />&nbsp;{<br />&nbsp;<span class="s1">//If element has a tag type of a, then return href tag but if element is of another type, check its parent to see if it is embedded in an A tag, if not keep on <br /></span>&nbsp;<span class="s1">//checking parents until it reaches the top most tag (html)<br /></span>&nbsp; &nbsp; var currentElement = e.target;<br />&nbsp; &nbsp; <span class="s2">while</span>(currentElement.nodeName!='HTML')<br />&nbsp; &nbsp; {<br />&nbsp;&nbsp; &nbsp; &nbsp; <span class="s1">//console.log('Parent Node: '+parent.nodeName);<br /></span>&nbsp;&nbsp; &nbsp; &nbsp; <span class="s2">if</span>(currentElement.tagName == <span class="s3">'A'</span>)<br />&nbsp;&nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">if</span>(currentElement.href.indexOf('javascript:')==0)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; window.external.notify('{\'id\':\'message_printout-'+GenerateID()+<span class="s3">'\',\'</span>action\':\'message_printout\',\'message\':\'Link was clicked with javascript <span class="s2">void</span> or some javascript function\<span class="s3">'}'</span>);<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">return</span> <span class="s2">true</span>;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var rel = currentElement.rel;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var target = currentElement.target;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var newpage = <span class="s2">false</span>;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">if</span>(rel=='external' || target=='_blank')<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; newpage = <span class="s2">true</span>;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; window.external.notify('{\'id\':\'leaving_page-'+GenerateID()+<span class="s3">'\',\'</span>action\':\'leaving_page\', \'url\':\'' + currentElement.href +<span class="s3">'\', newpage:\'</span>'+newpage+<span class="s3">'\'}'</span>);<br />&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; <span class="s2">return</span> <span class="s2">false</span>;<br />&nbsp;&nbsp; &nbsp; &nbsp; }<br />&nbsp;&nbsp; &nbsp; &nbsp; currentElement = currentElement.parentNode;<br />&nbsp; &nbsp; }<br />}<br />&nbsp;<span class="s2">return</span> <span class="s2">true</span>;<br />&nbsp;}</span></blockquote><span style="font-family: Arial, Helvetica, sans-serif;">Note: The window.external.notify code is specific to WebView inside Windows Store. What I'm doing here is basically notifying my application from javascript inside the WebView. So when a link is clicked I would get a message with the url, which I will then handle my self. You could just replace window.external.notify with console.log or your own function call.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br />This should detect links for 80% of the cases. The 20% cases will be iFrames, and dynamic websites that use jquery and ajax. You would have to handle iframes separately, look at each iframe, find its document element and execute this javascript inside it.&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br />For other complex websites, the script above might not detect on click events. An example would be mail.yahoo.com, when you load an email, the link detection script above would not detect any clicks inside the email body. I wasn't able to figure out why this is happening other than the onclick is being handled by some other script. So for these small cases I just altered the url (inside the href tag) to call my function. It would look like this: &nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br />        </span><br /><blockquote><span style="color: #666666; font-family: Arial, Helvetica, sans-serif;">function CustomOnClick(url, newpage)<br />{<br /> &nbsp;&nbsp; <span class="s1">//console.log('link-detect: ' + url + ' ' + newpage );<br /> </span>}</span></blockquote><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><br /><blockquote><span style="color: #666666; font-family: Arial, Helvetica, sans-serif;">function linkReplacementScript()<br />{<br />&nbsp; &nbsp; var aTagList = document.getElementsByTagName(<span class="s2">'a'</span>);<br />&nbsp; &nbsp; <span class="s3">for</span>(i = 0; i&lt;aTagList .length; i++)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; var url = aTagList[i].href;<br />&nbsp; &nbsp; &nbsp; var rel = aTagList[i].rel;<br />&nbsp; &nbsp; &nbsp; var target = aTagList[i].target;<br />&nbsp; &nbsp; &nbsp; aTagList[i].rel = '';<br />&nbsp; &nbsp; &nbsp; aTagList[i].target = '';<br />&nbsp; &nbsp; &nbsp; var newpage = <span class="s3">false</span>;<br />&nbsp; &nbsp; &nbsp; <span class="s3">if</span>(rel=='external' || target=='_blank')<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;newpage = <span class="s3">true</span>;<br />&nbsp; &nbsp; &nbsp; <span class="s3">if</span>(url.indexOf('javascript:')==0)<br />&nbsp;&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; <span class="s1">//do nothing if its javascript code<br /></span>&nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; <span class="s3">else<br /></span>&nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; aTagList[i].href = 'javascript:CustomOnClick(\''+url+<span class="s2">'\',\'</span>'+newpage+<span class="s2">'\');'</span>;<br />&nbsp; &nbsp; &nbsp; }<br />&nbsp;&nbsp; }<br />}</span></blockquote><span style="font-family: Arial, Helvetica, sans-serif;">But then there are cases where the dom is altered after the page has loaded. An example of this would be dynamic websites that insert content using ajax/jquery. For this case we would have to detect when the dom has changed and then call the link replacement script above. There is a way to detect this using MutationObserver (<a href="http://stackoverflow.com/a/14570614">see this post</a>).&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Basically whenever you get a dom updated event, you would call the link replacement script. Note: the link replacement script is only for cases where the link detection script has failed. It's sort of a catch all fallback just incase.&nbsp;</span></div></div>
</div>