---
title: "Kinect + Raspberry Pi"
layout: "post"
permalink: "/2013/02/kinect-raspberry-pi.html"
uuid: "5834463468474290863"
guid: "tag:blogger.com,1999:blog-4627720939429298175.post-5834463468474290863"
date: "2013-02-24 03:32:00"
updated: "2013-04-15 05:06:33"
description: 
blogger:
    siteid: "4627720939429298175"
    postid: "5834463468474290863"
    comments: "2"
categories: [development, kinect, raspberrypi]
author: 
    name: "Gremsi"
    url: "http://www.blogger.com/profile/00614962079213173450?rel=author"
    image: "http://img2.blogblog.com/img/b16-rounded.gif"
---

<div class="css-full-post-content js-full-post-content">
<div dir="ltr" style="text-align: left;" trbidi="on"><span style="font-family: Arial, Helvetica, sans-serif;">I have been trying to get the Kinect to work with Raspberry Pi (attempting to get raw depth data) but still keep on hitting roadblocks. The motor was able to tilt when using libfreenect. As for Open NI, I was able to get it to recognize the kinect but unable to get data from the camera.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><br /><b id="internal-source-marker_0.7092834080103785"><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-weight: bold; vertical-align: baseline; white-space: pre-wrap;">Install libraries using this tutorial (use unstable) </span><span style="color: #1155cc; font-weight: normal; vertical-align: baseline; white-space: pre-wrap;"><a href="http://mewgen.com/Ge107_files/20120921%20Setting%20up%20Rasberry%20pi%20for%20the%20Xtion%20and%20kinect.html" style="font-weight: normal;">http://mewgen.com/Ge107_files/20120921%20Setting%20up%20Rasberry%20pi%20for%20the%20Xtion%20and%20kinect.html</a></span></span></b><br /><span style="font-family: Arial, Helvetica, sans-serif;"><span style="color: #1155cc;"><span style="white-space: pre-wrap;"><br /></span></span></span><span style="font-family: Arial, Helvetica, sans-serif;"><span style="white-space: pre-wrap;">alternate link: <a href="http://gremsi.blogspot.com/2013/04/installing-openni-sensorkinect-and.html">http://gremsi.blogspot.com/2013/04/installing-openni-sensorkinect-and.html</a></span><br /><a href="http://mewgen.com/Ge107_files/20120921%20Setting%20up%20Rasberry%20pi%20for%20the%20Xtion%20and%20kinect.html" style="font-weight: normal;"><span style="color: #1155cc; vertical-align: baseline; white-space: pre-wrap;"></span></a><br /><span style="font-style: italic; font-weight: normal; vertical-align: baseline; white-space: pre-wrap;">Status: Recognizes the kinect but cannot transfer data.</span><br /><span style="font-weight: normal; vertical-align: baseline; white-space: pre-wrap;"></span><br /><span style="font-weight: bold; vertical-align: baseline; white-space: pre-wrap;">General Commands:</span><br /><span style="font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">compile sample files</span><br /><span style="font-weight: normal; vertical-align: baseline; white-space: pre-wrap;"><span class="Apple-tab-span" style="white-space: pre;"> </span>~/Desktop/kinect/OpenNI/Platform/Linux/Build $ make</span><br /><span style="font-weight: normal; vertical-align: baseline; white-space: pre-wrap;"></span><br /><span style="font-weight: normal; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">build/install open ni</span><br /><span style="font-weight: normal; vertical-align: baseline; white-space: pre-wrap;"><span class="Apple-tab-span" style="white-space: pre;"> </span>~/Desktop/kinect/unstable/OpenNI/Platform/Linux/CreateRedist $ sudo ./RedistMaker.Arm </span><br /><span style="font-weight: normal; vertical-align: baseline; white-space: pre-wrap;"><span class="Apple-tab-span" style="white-space: pre;"> </span>~/Desktop/kinect/unstable/OpenNI/Platform/Linux/Redist $ sudo ./install.sh</span><br /><span style="font-weight: normal; vertical-align: baseline; white-space: pre-wrap;"></span><br /><span style="font-weight: bold; vertical-align: baseline; white-space: pre-wrap;">Trial and Error</span><br /><span style="font-weight: normal; vertical-align: baseline; white-space: pre-wrap;"></span></span><br /><ol style="margin-bottom: 0pt; margin-top: 0pt;"><li dir="ltr" style="list-style-type: decimal; vertical-align: baseline;"><span id="internal-source-marker_0.7092834080103785" style="font-family: Arial, Helvetica, sans-serif;"><span style="vertical-align: baseline; white-space: pre-wrap;">used this site to change usbinterface line in unstable sensor kinect: </span><span style="color: #1155cc; text-decoration: underline; vertical-align: baseline; white-space: pre-wrap;">http://daybydaylinux.blogspot.com/2012/12/how-to-compile-openni-and-sensorkinect.html</span><a href="http://daybydaylinux.blogspot.com/"><span style="color: #1155cc; vertical-align: baseline; white-space: pre-wrap;"></span></a></span></li><ol style="margin-bottom: 0pt; margin-top: 0pt;"><li dir="ltr" style="list-style-type: lower-alpha; vertical-align: baseline;"><span id="internal-source-marker_0.7092834080103785" style="font-family: Arial, Helvetica, sans-serif;"><span style="background-color: black; color: #aeaeae; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">cd ~/kinect/SensorKinect/Platform/Linux/Redist/Sensor-Bin-Linux-Arm-v5.1.2.1/Config/<br class="kix-line-break" /><br class="kix-line-break" />sudo vi GlobalDefaultsKinect.ini</span><span style="background-color: black; color: #aeaeae; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">modify`;UsbInterface=2` into `UsbInterface=1`</span></span></li><li dir="ltr" style="list-style-type: lower-alpha; vertical-align: baseline;"><span id="internal-source-marker_0.7092834080103785"><span style="font-family: Arial, Helvetica, sans-serif; font-style: italic; vertical-align: baseline; white-space: pre-wrap;">Status: instead of saying usb interface not supported, it says: UpdateData failed: A timeout has occurred when waiting for new data!</span></span></li></ol><li dir="ltr" style="list-style-type: decimal; vertical-align: baseline;"><span id="internal-source-marker_0.7092834080103785"><span style="font-family: Arial, Helvetica, sans-serif; vertical-align: baseline; white-space: pre-wrap;">Attempt to fix timeout issue: change line in Include/XnTypes.h for data_timeout from 2000 to 20,000 and build open ni</span></span></li><ol style="margin-bottom: 0pt; margin-top: 0pt;"><li dir="ltr" style="list-style-type: lower-alpha; vertical-align: baseline;"><span id="internal-source-marker_0.7092834080103785"><span style="font-family: Arial, Helvetica, sans-serif; vertical-align: baseline; white-space: pre-wrap;">status: changing it to 20seconds and 1 minute and did not work</span></span></li></ol><li dir="ltr" style="list-style-type: decimal; vertical-align: baseline;"><span id="internal-source-marker_0.7092834080103785" style="font-family: Arial, Helvetica, sans-serif;"><span style="vertical-align: baseline; white-space: pre-wrap;">Was not able to change the FPS for depth because it only supports 15fps (</span><a href="http://openni-discussions.979934.n3.nabble.com/OpenNI-dev-How-to-change-FPS-td2500973.html"><span style="color: #1155cc; vertical-align: baseline; white-space: pre-wrap;">http://openni-discussions.979934.n3.nabble.com/OpenNI-dev-How-to-change-FPS-td2500973.html</span></a><span style="vertical-align: baseline; white-space: pre-wrap;">) </span></span></li></ol><b id="internal-source-marker_0.7092834080103785"><span style="font-family: Arial, Helvetica, sans-serif;"><span style="font-weight: normal; vertical-align: baseline; white-space: pre-wrap;"></span><br /><span style="font-weight: bold; vertical-align: baseline; white-space: pre-wrap;">Trace Back: NiSimpleRead</span></span></b><br /><span style="white-space: pre-wrap;"><span style="font-family: Arial, Helvetica, sans-serif;">Attempting to trace the problem to see where it occurs. </span></span><br /><span style="white-space: pre-wrap;"><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span></span><br /><ol style="margin-bottom: 0pt; margin-top: 0pt;"><span id="internal-source-marker_0.7092834080103785" style="font-family: Arial, Helvetica, sans-serif; font-weight: normal;"><li dir="ltr" style="list-style-type: decimal; vertical-align: baseline;"><span style="vertical-align: baseline; white-space: pre-wrap;">Samples/NiSimpleRead/NiSimpleRead.cpp<br class="kix-line-break" />line 103: context.</span><span style="vertical-align: baseline; white-space: pre-wrap;">WaitOneUpdateAll</span><span style="vertical-align: baseline; white-space: pre-wrap;">(depth)</span></li><li dir="ltr" style="list-style-type: decimal; vertical-align: baseline;"><span style="vertical-align: baseline; white-space: pre-wrap;">Include/XnCppWrapper.h<br class="kix-line-break" />line 9421: return </span><span style="vertical-align: baseline; white-space: pre-wrap;">xnWaitOneUpdateAll</span><span style="vertical-align: baseline; white-space: pre-wrap;">(...)</span></li><li dir="ltr" style="list-style-type: decimal; vertical-align: baseline;"><span style="vertical-align: baseline; white-space: pre-wrap;">Source/OpenNI.cpp<br class="kix-line-break" />line 2601: </span><span style="vertical-align: baseline; white-space: pre-wrap;">xnWaitForCondition</span><span style="vertical-align: baseline; white-space: pre-wrap;">(...)</span></li><li dir="ltr" style="list-style-type: decimal; vertical-align: baseline;"><span style="vertical-align: baseline; white-space: pre-wrap;">Source/OpenNI.cpp<br class="kix-line-break" />line 2552: </span><span style="vertical-align: baseline; white-space: pre-wrap;">xnOSWaitForCondition</span><span style="vertical-align: baseline; white-space: pre-wrap;">(...) </span></li><li dir="ltr" style="list-style-type: decimal; vertical-align: baseline;"><span style="vertical-align: baseline; white-space: pre-wrap;">Source/XnOS.cpp<br class="kix-line-break" />line 236: </span><span style="vertical-align: baseline; white-space: pre-wrap;">xnOSWaitEvent(...)</span></li><li dir="ltr" style="list-style-type: decimal; vertical-align: baseline;"><span style="vertical-align: baseline; white-space: pre-wrap;">Source/OpenNI/Linux/LinuxEvents.cpp</span><span style="vertical-align: baseline; white-space: pre-wrap;"><br class="kix-line-break" /></span><span style="vertical-align: baseline; white-space: pre-wrap;">line 160: </span><span style="vertical-align: baseline; white-space: pre-wrap;">pEvent-&gt;Wait(...)</span></li></span></ol><span style="font-family: Arial, Helvetica, sans-serif;"><span id="internal-source-marker_0.7092834080103785"></span></span><br /><div><span id="internal-source-marker_0.7092834080103785"><span style="font-family: Arial, Helvetica, sans-serif; white-space: pre-wrap;"><br /></span></span><span style="font-family: Arial, Helvetica, sans-serif;"><span style="white-space: pre-wrap;">Somehow xnOSWaitEvent is linked with Source/OpenNI/Linux/XnUSBLinux.cpp: xnUSBReadThreadMain. I am assuming its linked because I got an warning (after i set the usb interface to 1):</span><span style="white-space: pre-wrap;"> </span>USB events thread - failed to set priority. And this error message originates in the file XnUSBLinux</span><br /><br /><span style="font-family: Arial, Helvetica, sans-serif;">I'm currently trying to see if data is being transferred at all or if the Kinect is just waiting and not sending data.</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">Side note: you can change the option to print out the logs for OpenNI in the Data/SampleConfig.xml file.</span><br /><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br />[Update: 2/24]: Some people had some success with the beagleboard and the kinect:</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">&nbsp;&nbsp;<a href="http://www.pansenti.com/wordpress/?page_id=1772">http://www.pansenti.com/wordpress/?page_id=1772</a></span><br /><span style="font-family: Arial, Helvetica, sans-serif;">&nbsp;&nbsp;<a href="http://instructionalrobotics.blogspot.com/2013/01/kinect-under-beagleboard-c4.html%C2%A0">http://instructionalrobotics.blogspot.com/2013/01/kinect-under-beagleboard-c4.html&nbsp;</a></span><br /><br /><span style="font-family: Arial, Helvetica, sans-serif;">[Update: 2/27]:</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">I updated the file XnUSBLinux.cpp to printout the transfer status. In the xnUSBReadThreadMain method, I added these lines (in bold):</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">//more code...</span><br /><br /><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">else // transfer done</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><br /></span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>if (pBufferInfo-&gt;nLastStatus == LIBUSB_TRANSFER_COMPLETED || // read succeeded</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>pBufferInfo-&gt;nLastStatus == LIBUSB_TRANSFER_CANCELLED) &nbsp; // cancelled, but maybe some data arrived</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>i<b>f(pBufferInfo-&gt;nLastStatus == LIBUSB_TRANSFER_COMPLETED)</b></span></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>printf("***** pBufferInfo-&gt;nLastStatus = LIBUSB_TRANSFER_COMPLETED\n");</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>else if(pBufferInfo-&gt;nLastStatus == LIBUSB_TRANSFER_CANCELLED)</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>printf("***** pBufferInfo-&gt;nLastStatus == LIBUSB_TRANSFER_CANCELLED\n");</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></b></div><div class="p2"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span></span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>if (pTransfer-&gt;type == LIBUSB_TRANSFER_TYPE_ISOCHRONOUS)</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>XnUInt32 nTotalBytes = 0;</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span></span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>// some packets may return empty, so we need to remove spaces, and make the buffer sequential</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>for (XnUInt32 i = 0; i &lt; pTransfer-&gt;num_iso_packets; ++i)</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>struct libusb_iso_packet_descriptor* pPacket = &amp;pTransfer-&gt;iso_packet_desc[i];</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>if (/*pPacket-&gt;status == LIBUSB_TRANSFER_COMPLETED &amp;&amp; */pPacket-&gt;actual_length != 0)</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>XnUChar* pBuffer = libusb_get_iso_packet_buffer_simple(pTransfer, i);</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>// if buffer is not at same offset, move it</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>if (pTransfer-&gt;buffer + nTotalBytes != pBuffer)</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">//<span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>printf("buffer %d has %d bytes. Moving to offset %d...\n", i, pPacket-&gt;actual_length, nTotalBytes);</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>memmove(pTransfer-&gt;buffer + nTotalBytes, pBuffer, pPacket-&gt;actual_length);</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>nTotalBytes += pPacket-&gt;actual_length;</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>else if (pPacket-&gt;status != LIBUSB_TRANSFER_COMPLETED)</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>xnLogWarning(XN_MASK_USB, "2 Endpoint 0x%x, Buffer %d, packet %d Asynch transfer failed (status: %d)", pTransfer-&gt;endpoint, pBufferInfo-&gt;nBufferID, i, pPacket-&gt;status);</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><br /></span></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>if(pPacket-&gt;status == LIBUSB_TRANSFER_COMPLETED)</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>printf("*****pPacket-&gt;status = LIBUSB_TRANSFER_COMPLETED. Length: %d\n", pPacket-&gt;actual_length);</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>else if(pPacket-&gt;status == LIBUSB_TRANSFER_CANCELLED)</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>printf("*****pPacket-&gt;Status = TRANSFER CANCELLED Length: %d\n", pPacket-&gt;actual_length);</span></b></div><div class="p1"><b><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></b></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></div><div class="p2"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span></span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>if (nTotalBytes != 0)</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>// call callback method</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>pBufferInfo-&gt;pThreadData-&gt;pCallbackFunction(pTransfer-&gt;buffer, nTotalBytes, pBufferInfo-&gt;pThreadData-&gt;pCallbackData);</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>else</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>{</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>// call callback method</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>pBufferInfo-&gt;pThreadData-&gt;pCallbackFunction(pTransfer-&gt;buffer, pTransfer-&gt;actual_length, pBufferInfo-&gt;pThreadData-&gt;pCallbackData);</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span><span class="Apple-tab-span"> </span>}</span></div><div class="p1"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">//more code...</span></div><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">After building and installing, I ran ./Sample-NiSimpleRead again.&nbsp;<a href="https://www.dropbox.com/s/9g58ljacrt0jlqa/log.txt?m">Click here</a> to see the output (the lines that begin with '*****' are my print line statements).&nbsp;</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">The main things to focus on are these lines:</span><br /><pre class="brush: text; plain-text" id="code" style="color: #444444; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; font-size: 12px; overflow: auto; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="font-family: Courier New, Courier, monospace; font-size: x-small;">*****pPacket-&gt;status = LIBUSB_TRANSFER_COMPLETED. Length: 1760&nbsp;</span></pre><span style="font-family: Courier New, Courier, monospace; font-size: x-small;"><span style="white-space: pre-wrap;">*****pPacket-&gt;status = LIBUSB_TRANSFER_COMPLETED. Length: 1920</span>&nbsp;</span><br /><pre class="brush: text; plain-text" id="code" style="color: #444444; font-family: Consolas, 'Bitstream Vera Sans Mono', 'Courier New', Courier, monospace !important; overflow: auto; padding: 0px; white-space: pre-wrap; word-wrap: break-word;"><span style="font-size: x-small;"><strike>*****pPacket-&gt;status = LIBUSB_TRANSFER_COMPLETED. Length: 0</strike></span></pre><strike><br /></strike><span style="font-family: Arial, Helvetica, sans-serif;"><strike>The transfer seems to be completed but the length of the packet is 0. Not sure why this is happening.&nbsp;</strike></span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">I left Sample-NiSimpleRead running longer, and noticed I was getting data back from the Kinect. The packet would hold 1760 or 1920 bytes at a time. (the log file has been updated with the new log)</span><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;">[Update 3/29]</span><br /><span style="font-family: Arial, Helvetica, sans-serif;">Unfortunately, I wasn't able to get it working with the Kinect. I am currently looking into other options.&nbsp;</span><br /><br /><ul style="text-align: left;"><li><span style="font-family: Arial, Helvetica, sans-serif;">Asus Xtion + Raspberry Pi: I was able to get frames back from an Asus Xtion.</span></li><li><span style="font-family: Arial, Helvetica, sans-serif;">Kinect + Beagle Board (or Panda Board): I haven't had the chance to try this out but in theory since this is a little more powerful than the RPi, it could work with the kinect.&nbsp;</span></li></ul><div><span style="font-family: Arial, Helvetica, sans-serif;">I am currently working on getting and compressing the depth images using OpenNI. See <a href="http://gremsi.blogspot.com/2013/03/openni-depth-compression.html">OpenNI + Depth Compression</a></span></div><br /><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span><span style="font-family: Arial, Helvetica, sans-serif;"><br /></span></div><span id="internal-source-marker_0.7092834080103785"></span></div>
</div>
<div class="css-full-comments-content js-full-comments-content">
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://www.blogger.com/profile/05823384133529381114">
  <div class="css-comment-name js-comment-name">
    liu muye
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2013-03-02T02:12:53.564Z
  </div>
  </div>
  <div class="css-comment-title js-comment-title">
    Hello,

I had same problem putting Kinect and Rasp...
  </div>
  <div class="css-comment-content js-comment-content">
    Hello,<br /><br />I had same problem putting Kinect and Raspberry Pi together. <br /><br />Seems like so far, there is no one can get Kinect working with Raspberry Pi. However, there are few success on bridging ASUS Xtion with Raspberry Pi.<br /><br />Thanks
  </div>
  <br/>
</div>
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://www.blogger.com/profile/00614962079213173450">
  <div class="css-comment-name js-comment-name">
    Gremsi
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2013-03-02T03:03:59.700Z
  </div>
  </div>
  <div class="css-comment-title js-comment-title">
    Hi Liu,

Hmm, maybe I&#39;ll try it with an Xtion ...
  </div>
  <div class="css-comment-content js-comment-content">
    Hi Liu,<br /><br />Hmm, maybe I&#39;ll try it with an Xtion since I just need depth data. Thanks for the information!<br /><br />So it seems that the Kinect is sending some kind of data to the raspberry pi. I just left the Sample-NiSimpleRead program running a little longer and packets of size 1760 and 1920 bytes were being received. 
  </div>
  <br/>
</div>
</div>