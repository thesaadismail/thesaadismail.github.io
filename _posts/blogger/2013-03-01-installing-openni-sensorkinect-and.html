---
title: "Installing OpenNI, SensorKinect, and PrimeSense on a Raspberry Pi"
layout: "post"
permalink: "/2013/04/installing-openni-sensorkinect-and.html"
uuid: "1654701663972875163"
guid: "tag:blogger.com,1999:blog-4627720939429298175.post-1654701663972875163"
date: "2013-03-01 06:04:00"
updated: "2013-04-15 05:05:30"
description: 
blogger:
    siteid: "4627720939429298175"
    postid: "1654701663972875163"
    comments: "0"
categories: [development, kinect]
author: 
    name: "Gremsi"
    url: "http://www.blogger.com/profile/00614962079213173450?rel=author"
    image: "http://img2.blogblog.com/img/b16-rounded.gif"
---

<div class="css-full-post-content js-full-post-content">
<div dir="ltr" style="text-align: left;" trbidi="on"><br /><div style="margin-bottom: 0.21cm;">Source:&nbsp;<a href="http://mewgen.com/Ge107_files/20120921%20Setting%20up%20Rasberry%20pi%20for%20the%20Xtion%20and%20kinect.html">http://mewgen.com/Ge107_files/20120921%20Setting%20up%20Rasberry%20pi%20for%20the%20Xtion%20and%20kinect.html</a></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;">I did not create these instructions, I only reposted them here just incase they got removed.</div><div style="margin-bottom: 0.21cm;">_Using Win32DiskImager (for windows)</div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_downloaded 2012-08-16-wheezy-raspbian from website (&nbsp;<a href="http://www.raspberrypi.org/downloads">http://www.raspberrypi.org/downloads</a>&nbsp;)</span></div><div style="margin-bottom: 0.21cm;">_burnt the image onto a 16Gb Class 10 (up to 95MB/s) Sandisk Extreme Pro card</div><div style="margin-bottom: 0.21cm;">_Powerup the Pi using a 5V 1Amp supply</div><div style="margin-bottom: 0.21cm;">_Note:&nbsp;<i>Italics</i>&nbsp;is what is typed into the Pi shell or added to scripts/code</div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;">_Power&nbsp;up the Pi, I am assuming you are plugged into the dvi port, if you cannot and only want to SSH then you need to know the IP address (one way is to look at the router's DHCP assigned table)</div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;">_On Pi startup menu:</div><div style="margin-bottom: 0.21cm;">- expand to use the whole card</div><div style="margin-bottom: 0.21cm;">- change the timezone to Aust -&gt; Syd</div><div style="margin-bottom: 0.21cm;">- change local to AST-UTF-8 and default for system GB-UTF-8</div><div style="margin-bottom: 0.21cm;">- turn on the SSH server (it should be on by default)</div><div style="margin-bottom: 0.21cm;">- do an update</div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;">_Then from the shell, O<span lang="en-AU">verclock: (For details see&nbsp;<a href="http://elinux.org/RPi_config.txt">http://elinux.org/RPi_config.txt</a>&nbsp;)</span><span lang="en-AU"><i>sudo</i></span><span lang="en-AU">&nbsp;</span><span lang="en-AU"><i>nano /boot/config.txt</i></span></div><div style="margin-bottom: 0.21cm;">_If you&nbsp;<b>don't want to&nbsp;</b>void your warranty on the Pi then I suggest you use these settings<br /><span lang="en-AU"><i>arm_freq=855</i></span><br /><span lang="en-AU"><i>sdram_freq=500</i></span></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU"><i><br /></i></span><span lang="en-AU">_If you&nbsp;</span><span lang="en-AU"><b>don't mind voiding your warranty&nbsp;</b></span><span lang="en-AU">added these lines after the last line. These are the setting I am using. if they don't work on bootup the press “shift” while booting I think to do a non-overclocked boot&nbsp;</span><span lang="en-AU"><i>force_turbo=1<br />over_voltage=8<br />arm_freq=1150<br />core_freq=500<br />sdram_freq=600</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_Get the ipaddress for eth0 assuming you are using ethernet</span><span lang="en-AU"><i>ifconfig</i></span>&nbsp;<span lang="en-AU"><i>eth0</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_Then shutdown and power cycle the Pi so the card can be expanded and new faster config can be used</span><span lang="en-AU"><i>sudo</i></span>&nbsp;<span lang="en-AU"><i>shutdown now</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;">_ After rebooting check the new CPU speed:<br /><i>more /proc/cpuinfo</i></div><div style="margin-bottom: 0.21cm;">_Also if you are worried about the temperature you can check it by going here:&nbsp;<i>cd /opt/vc/bin/</i></div><div style="margin-bottom: 0.21cm;">_and run this script:&nbsp;<i>./vcgencmd measure_temp</i></div><div style="margin-bottom: 0.21cm;">_ for all the possible commands use: ./<i>vcgencmd commands</i><br /><br /></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ Go to the shell (via ssh use IP address is easiest, tunnel X through ssh and for windows use X server like Xming)</span><span lang="en-AU"><i>sudo</i></span>&nbsp;<span lang="en-AU"><i>apt-get update<br />sudo apt-get install git g++ python libusb-1.0-0-dev freeglut3-dev openjdk-6-jdk doxygen graphviz</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ Get&nbsp;</span><span lang="en-AU"><b>stable</b></span><span lang="en-AU">&nbsp;OpenNI and the drivers (this failed several times but keep trying)</span><span lang="en-AU"><i>mkdir stable<br />cd stable</i></span><em><span lang="en-AU">git clone&nbsp;<a href="https://github.com/OpenNI/OpenNI.git" target="_blank">https://github.com/OpenNI/OpenNI.git</a></span></em><span lang="en-AU"><i><br />git clone git://<a href="http://github.com/avin2/SensorKinect.git" target="_blank">github.com/avin2/SensorKinect.git</a><br />git clone&nbsp;<a href="https://github.com/PrimeSense/Sensor.git">https://github.com/PrimeSense/Sensor.git</a></i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ Get&nbsp;</span><span lang="en-AU"><b>unstable</b></span><span lang="en-AU">&nbsp;OpenNI and the drivers</span><span lang="en-AU"><i>mkdir unstable<br />cd unstable</i></span><em><span lang="en-AU">git clone&nbsp;<a href="https://github.com/OpenNI/OpenNI.git" target="_blank">https://github.com/OpenNI/OpenNI.git</a>&nbsp;-b unstable&nbsp;</span></em><span lang="en-AU"><i><br />git clone git://<a href="http://github.com/avin2/SensorKinect.git" target="_blank">github.com/avin2/SensorKinect.git</a>&nbsp;-b unstable<br />git clone&nbsp;<a href="https://github.com/PrimeSense/Sensor.git">https://github.com/PrimeSense/Sensor.git</a>&nbsp;-b unstable</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;">_I will do the following just for&nbsp;<b>stable</b>&nbsp;but all steps must be done for unstable too<br /><u><b>Note: only do the install step for one or the other</b></u></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_The&nbsp;</span><span lang="en-AU"><i>calc_jobs_number()&nbsp;</i></span><span lang="en-AU">function in the scripts doesn't seem to work on the Pi, so change python script</span><span lang="en-AU"><i>nano ~/stable/OpenNI/Platform/Linux/CreateRedist/Redist_OpenNi.py</i></span></div><div style="margin-bottom: 0.21cm;"><i>_</i>from containing this:<br /><i>MAKE_ARGS += ' -j' + calc_jobs_number()</i></div><div style="margin-bottom: 0.21cm;">_to<br /><i>MAKE_ARGS += ' -j1'</i></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ Must also change the Arm compiler settings for this distribution of the Pi</span><span lang="en-AU"><i>nano</i></span>&nbsp;<span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>OpenNI/Platform/Linux/Build/Common/Platform.Arm</i></span></div><div style="margin-bottom: 0.21cm;">_from<br /><i>CFLAGS += -march=armv7-a -mtune=cortex-a8 -mfpu=neon -mfloat-abi=softfp #-mcpu=cortex-a8</i></div><div style="margin-bottom: 0.21cm;">_to<br /><i>CFLAGS += -mtune=arm1176jzf-s -mfpu=vfp -mfloat-abi=hard</i></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_Then run&nbsp;</span><span lang="en-AU"><i>cd</i></span>&nbsp;<span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>OpenNI/Platform/Linux/CreateRedist/<br />./RedistMaker.Arm<br />cd</i></span>&nbsp;<span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>OpenNI/Platform/Linux/Redist/OpenNI-Bin-Dev-Linux-Arm-v1.5.2.23<br />sudo</i></span>&nbsp;<span lang="en-AU"><i>./install.sh</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">Go to the Redist and run install (for stable&nbsp;</span><span lang="en-AU"><b>or</b></span><span lang="en-AU">&nbsp;unstable not both)</span><span lang="en-AU"><i>cd</i></span>&nbsp;<span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>OpenNI/Platform/Linux/Redist/OpenNI-Bin-Dev-Linux-Arm-v1.5.4.0<br />sudo</i></span>&nbsp;<span lang="en-AU"><i>./install.sh</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ Also edit the Sensor and SensorKinect makefile CFLAGS parameters<br />nano</span>&nbsp;<span lang="en-AU">~/</span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU">Sensor/Platform/Linux/Build/Common/Platform.Arm<br />nano</span>&nbsp;<span lang="en-AU">~/</span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU">SensorKinect/Platform/Linux/Build/Common/Platform.Arm</span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ and the Sensor and SensorKinect redistribution scripts</span><span lang="en-AU"><i>nano</i></span>&nbsp;<span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>Sensor/Platform/Linux/CreateRedist/RedistMaker<br />nano</i></span>&nbsp;<span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>SensorKinect/Platform/Linux/CreateRedist/RedistMaker</i></span></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ for both, change<br />make</span>&nbsp;<span lang="en-AU">-j$(calc_jobs_number) -C ../Build</span></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_to<br />make</span>&nbsp;-<span lang="en-AU">j1 -C ../Build</span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ The create the redistributables<br />_Sensor (primesense)</span><span lang="en-AU"><i>cd</i></span><span lang="en-AU">&nbsp;</span><span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>Sensor/Platform/Linux/CreateRedist/<br />./RedistMaker</i></span><span lang="en-AU">&nbsp;</span><span lang="en-AU"><i>Arm</i></span></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ and SensorKinect&nbsp;&nbsp;</span><span lang="en-AU">(note this does not work with stable OpenNI only the unstable. If fails about half way through with a problem of a missing header file) Note that on the SensorKinect git page it say that you need the unstable version of OpenNI for it to work</span><span lang="en-AU"><br /></span><span lang="en-AU"><i>cd</i></span>&nbsp;<span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>SensorKinect/Platform/Linux/CreateRedist/<br />./RedistMaker</i></span>&nbsp;<span lang="en-AU"><i>Arm</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ Then install either stable&nbsp;</span><span lang="en-AU"><b>or&nbsp;</b></span><span lang="en-AU">unstable</span></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ install for&nbsp;</span><span lang="en-AU"><b>stable</b></span><span lang="en-AU"><i>cd</i></span><span lang="en-AU">&nbsp;</span><span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>Sensor/Platform/Linux/Redist/Sensor-Bin-Linux-Arm-v5.1.0.41<br />sudo</i></span><span lang="en-AU">&nbsp;</span><span lang="en-AU"><i>./install.sh</i></span><strike><span lang="en-AU"><i>cd</i></span></strike><strike>&nbsp;</strike><strike><span lang="en-AU"><i>~/</i></span></strike><strike><span lang="en-AU"><i>stable/</i></span></strike><strike><span lang="en-AU"><i>SensorKinect/Platform/Linux/Redist/Sensor-Bin-Linux-Arm-v5.1.2.1<br />sudo ./install.sh</i></span></strike></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU">_ install for&nbsp;</span><span lang="en-AU"><b>unstable</b></span><span lang="en-AU"><i>cd</i></span><span lang="en-AU">&nbsp;</span><span lang="en-AU"><i>~/un</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>Sensor/Platform/Linux/Redist/Sensor-Bin-Linux-Arm-v5.1.2.1<br />sudo</i></span><span lang="en-AU">&nbsp;</span><span lang="en-AU"><i>./install.sh<br />cd</i></span>&nbsp;<span lang="en-AU"><i>~/un</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>SensorKinect/Platform/Linux/Redist/Sensor-Bin-Linux-Arm-v5.1.2.1<br />sudo ./install.sh</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;">&nbsp;<span lang="en-AU">_ Try running the sample reading program after pluging in sensor (check with&nbsp;</span><span lang="en-AU"><i>lsusb</i></span><span lang="en-AU">)</span><span lang="en-AU"><i>cd</i></span>&nbsp;<span lang="en-AU"><i>~/</i></span><span lang="en-AU"><i>stable/</i></span><span lang="en-AU"><i>OpenNI/Platform/Linux/Bin/Arm-Release</i></span></div><div style="margin-bottom: 0.21cm;"><span lang="en-AU"><i>sudo</i></span>&nbsp;<span lang="en-AU"><i>./Sample-NiCRead<br />sudo</i></span>&nbsp;<span lang="en-AU"><i>./Sample-NiBackRecorder time 1 depth vga<br />sudo</i></span>&nbsp;<span lang="en-AU"><i>./Sample-NiSimpleRead</i></span></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><b>_ Problems I had:</b></div><div style="margin-bottom: 0.21cm;">_you need a powered hub to run the Xtion</div><div style="margin-bottom: 0.21cm;">_ If you get timeout errors it can be because the hub isn't giving enough power, even if it shows up in "lsusb" I had to unplug the keyboard and mouse from the hub before it would work</div><div style="margin-bottom: 0.21cm;">_ I had to try different ports on the hub to get some demos to work, unplug and plug in again in a different port</div><div style="margin-bottom: 0.21cm;">_ when I used the unstable version of the Xtion driver I got:<br /><i>Open failed: Device Protocol: Bad Parameter sent!</i></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;">_I was using the stable version of the kinect it wouldn't even build. I get this error about halfway through the build</div><div style="margin-bottom: 0.21cm;"><span style="font-size: xx-small;">g++ -MD -MP -MT "./Arm-Release/XnActualGeneralProperty.d Arm-Release/XnActualGeneralProperty.o" -c -mtune=arm1176jzf-s -mfpu=vfp -mfloat-abi=hard -O3 -fno-tree-pre -fno-strict-aliasing -ftree-vectorize -ffast-math -funsafe-math-optimizations -fsingle-precision-constant -O2 -DNDEBUG -I/usr/include/ni -I../../../../Include -I../../../../Source -I../../../../Source/XnCommon -DXN_DDK_EXPORTS -fPIC -fvisibility=hidden -o Arm-Release/XnActualGeneralProperty.o ../../../../Source/XnDDK/XnActualGeneralProperty.cpp</span></div><div style="margin-bottom: 0.21cm;"><span style="font-size: xx-small;">In file included from ../../../../Source/XnDDK/XnGeneralProperty.h:28:0,<br />from ../../../../Source/XnDDK/XnActualGeneralProperty.h:28,<br />from ../../../../Source/XnDDK/XnActualGeneralProperty.cpp:25:</span></div><div style="margin-bottom: 0.21cm;"><span style="font-size: xx-small;">../../../../Source/XnDDK/XnProperty.h:29:21: fatal error: XnListT.h: No such file or directory<br />compilation terminated.<br />make[1]: *** [Arm-Release/XnActualGeneralProperty.o] Error 1<br />make[1]: Leaving directory `/home/pi/stable/SensorKinect/Platform/Linux/Build/XnDDK'<br />make: *** [XnDDK] Error 2<br />make: Leaving directory `/home/pi/stable/SensorKinect/Platform/Linux/Build'</span></div><div style="margin-bottom: 0.21cm;">_ See this page&nbsp;<a href="https://github.com/avin2/SensorKinect">https://github.com/avin2/SensorKinect</a>&nbsp;for the following notice on the above eror:</div><pre class="western">***** Important notice: *****<br />You must use this kinect mod version with the unstable OpenNI release......</pre><div style="margin-bottom: 0.21cm;">_ with the unstable version of the Kinect it built and installed but I was getting the error<br /><i>Open failed: USB interface is not supported!</i></div><div style="margin-bottom: 0.21cm;">_ So I had to edit<br /><i>sudo nano /usr/etc/primesense/GlobalDefaultsKinect.ini</i></div><div style="margin-bottom: 0.21cm;">_ and uncomment this line and changed it to 1 instead of 2<br /><i>UsbInterface=1</i></div><div style="margin-bottom: 0.21cm;">&nbsp;_ And then got lots of these errors<br /><i>UpdateData failed: A timeout has occurred when waiting for new data!</i></div><div style="margin-bottom: 0.21cm;">_ I tried doing this (without luck)<br /><strong><i><span style="font-weight: normal;">rmmod -f gspca_kinect</span></i></strong></div><div style="margin-bottom: 0.21cm;"><br /></div><div style="margin-bottom: 0.21cm;"><strong><span style="font-weight: normal;">_ Other: save image</span></strong></div><div style="margin-bottom: 0.21cm;"><strong><span style="font-weight: normal;">dd if=/dev/sdc of=~/2012-09-18-wheezy-raspbian_16GB_OpenNI-Stable+Unstable.img</span></strong></div><div style="margin-bottom: 0.21cm;"><strong><span style="font-weight: normal;">tar -zcvf 2012-09-18-wheezy-raspbian_16GB_OpenNI-Stable+Unstable.img.tar 2012-09-18-wheezy-raspbian_16GB_OpenNI-Stable+Unstable.img.img</span></strong></div></div>
</div>